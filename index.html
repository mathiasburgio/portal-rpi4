<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <title>Configuración WiFi</title>
        <style>
            body { font-family: Arial; text-align: center; margin-top: 80px; }
            select, input { margin: 10px; padding: 8px; width: 260px; }
            button { padding: 10px 20px; }
            small { color:#666; }
        </style>

    </head>
    <body>
        <h1>Configuración de WiFi</h1>
        <form action="/save" method="POST">
            <select id="ssid" name="ssid" required></select><br>
            <input type="password" name="password" placeholder="Contraseña" required><br>
            <button type="submit">Guardar</button>
        </form>
        <p><small>Mantén presionado el botón físico 5 seg. para reiniciar configuración</small></p>

        <script>
            async function cargarRedes() {
                const sel = document.getElementById('ssid');
                sel.innerHTML = '<option>Cargando redes...</option>';
                try {
                    const res = await fetch('/networks');
                    const nets = await res.json();
                    sel.innerHTML = '';
                    if (!nets || nets.length === 0) {
                        sel.innerHTML = '<option>No se detectaron redes</option>';
                        return;
                    }
                    for (const n of nets) {
                        const opt = document.createElement('option');
                        opt.value = n.ssid;
                        opt.textContent = `${n.ssid} ${n.signal? '('+n.signal+' dBm)':''}`;
                        sel.appendChild(opt);
                    }
                } catch(e) {
                    sel.innerHTML = '<option>Error al cargar</option>';
                }
            }
            window.onload = cargarRedes;
        </script>
    </body>
</html>